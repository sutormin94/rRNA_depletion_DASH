# rRNA_depletion_DASH
 Scripts used to prepare guide pools for DASH
 
# design_guides.py
A description was taken from original design_guides.py README.
Python tool to design sgRNA pools targeting the rRNA genes, as described in [this paper](https://rnajournal.cshlp.org/content/26/8/1069.long) (PMID: 32345633). 

## Dependencies
These Python (3.x) packages are required to run the script:

* Bio
* primer3-py
You'll also need to have [Bowtie](http://bowtie-bio.sourceforge.net/index.shtml) installed and available in the PATH.

## Usage
```
Designs a pool of sgRNAs targeting the ribosomal genes of a bacterial species.

optional arguments:
  -h, --help            show this help message and exit
  --minGC MINGC, -g MINGC
                        Minimal accepted GC% of a spacer (Default: 30).
  --maxGC MAXGC, -G MAXGC
                        Maximal accepted GC% of a spacer (Default: 80).
  --length LENGTH, -l LENGTH
                        Spacer length (Default: 20).
  --offtargets, -o      Print the spacers that were discarded because of off-
                        targeting.
  --manual_ann MANUAL_ANN, -ma MANUAL_ANN
                        Use if you want to provide a file with the manual
                        annotation (in bed format, tab-separated) of the rRNA genes (Default:
                        False).
  --pam PAM, -p PAM     PAM sequence (Default: NGG).
```
### Input

The working directory must have the **design_grnas.py** file and the subfolder **reference_sequences/**. If you want to use a gff3 annotation of the transcriptome, you'll also need the **annotations/** folder; if you want to provide Bowtie indexes of the reference sequences you'll also need the **bowtie_files/** subfolder.

* Copy the fasta sequences of the chromosome and plasmids (if any) in the reference_sequences/ folder. 

* If you already have Bowtie indexes of these sequences, put them in a subfolder named bowtie_files/. If you don't, the subfolder and the indexes will be generated by the script.

* If you want to use a gff3 annotation, copy the file(s) in the annotations/ folder. The rRNA genes must have the "rRNA" type (3rd column of the gff file). The scaffold ID(s) in column 1 of the file must be the same present in the fasta file(s) of reference_sequences/.

* If you don't want to use a gff annotation, provide the coordinates of the rRNA genes **in BED format** through the -manual_ann argument. The file must have the following fields (tab-separated and in this order; do not include a header): scaffold, start, end, name, score, strand
  - scaffold: ID of the scaffold (chromosome or plasmid). Must be the same present in the respective fasta file.
  - start: start position of the rRNA gene.
  - end: end position of the rRNA gene.
  - name: name of the rRNA gene. Must contain one among: 5S, 16S or 23S.
  - score: required by the BED format but not used by the script. Can be anything (e.g. a dot).
  - strand: strand of the rRNA gene.

  An example file is the following, for *B. thetaiotaomicron* rRNAs:
  ```
  NC_004663.1	1626501	1626612	5S_r01	.	-
  NC_004663.1	1626629	1629600	23S_r02	.	-
  NC_004663.1	1630071	1631660	16S_r03	.	-
  NC_004663.1	2336964	2337075	5S_r04	.	-
  NC_004663.1	2337153	2340121	23S_r05	.	-
  NC_004663.1	2340595	2342191	16S_r06	.	-
  NC_004663.1	3030969	3031080	5S_r07	.	-
  NC_004663.1	3031158	3034127	23S_r08	.	-
  NC_004663.1	3034601	3036195	16S_r09	.	-
  NC_004663.1	3325219	3325330	5S_r10	.	-
  NC_004663.1	3325408	3328377	23S_r11	.	-
  NC_004663.1	3328851	3330446	16S_r12	.	-
  NC_004663.1	4983424	4985021	16S_r13	.	+
  NC_004663.1	4985493	4988462	23S_r14	.	+
  NC_004663.1	4988479	4988590	5S_r15	.	+
  ```

After all files have been copied, run the **design_grnas.py** script.

### Output
The following files are generated by the script:

* oligos.csv: file with the sequences of the oligos that have to be ordered to generate the pool.
* grnas.fa: multifasta file with all the spacers selected by the script.
* bowtie.csv: output file of Bowtie (to have a look at oligos discarded for off-targeting).


# Raw_reads_processing.sh
General read mapping and coverage depth preparation.

Shell script that performes QC of the reads (fastQC), then it alignes forward reads to the reference genome (bwa mem), prepares sorted and indexed BAM-files and converts them to coverage depth file (samtools).

## Dependencies 

* factqc 
* bwa mem 
* samtools 

## Usage

With PWD variable, specify path to the working directory, which contains /Raw_data folder with raw reads files in fq.gz format.
With Ref_genome variable, specify path to the reference genome in fasta/fna format.
With fastqc, bwa, and samtools variables specify pathes to corresponding executables.

## Output

* In FastQC directory, fastQC reports are stored.
* In SAM, BAM, and BAM_sorted directories, temporary alignments are stored. These are not used in further analysis and can be removed manually if not needed.
* In Genome_coverage_depth directory, coverage depth tracks in bed format are stored.


# Bed_to_wig_converter.py
Converts bed-like coverage file(s) to wig format.

## Dependencies

Python 3.x

## Usage

With PWD variable, specify path to the working directory.
With filein_path_dict variable, specify path(es) to the input bed file(s) to be converted to wig.
With fileout_path_dict variable, specify path(es) to the output wig file(s).
With name_dict variable, specify IDs for wig tracks (will appear as track names in IGV browser).
With Chromosome_name variable, specify chromosome name for wig file. It mist match chromosome name in the reference fasta file. Not needed if Auto_or_manual=0.
With Auto_or_manual variable, specify the mode of chromosome name writing: 0 - auto detection from bed file provided, 1 - manualy provided by user in Chromosome_name variable.

## Output

Wig files in a directory specified in the fileout_path_dict. Wig files can be viewed in IGV or similar genomic browsers.


# Select_genomic_region.py
Select genomic region of interest.

Select genomic region to which sgRNAs to be designed.
Normalizes coverage depth by total coverage depth and averages normalized cov depth between replicates provided.
Outputs normalized avreged cov depth for a region of interest (ROI).

## Dependencies

Python 3.x including packages:

* os
* numpy
* Bio

## Usage

With Dict_of_cov_depth variable, specify path(es) to wig file(s) you want to normalize, average, and extract coverage depth profile for ROI from.
With Ref_gen_path variable, specify path to the reference genome in fasta/fna format.
With Coordinates_ar variable, specify genomic coordinates [start, stop] for ROI. If targeting rRNA operon, choose one in + orientation.
With Output_path variable, specify path to where output files will be generated.
With Dataset name variable, specify name of ROI (it will appear in generated fasta and wig files).

## Output

Fasta with sequence of ROI and wig file with normalized averaged coverage depth profile for ROI.


# Rarefy_sgRNA_using_cov_depth.py
Rarefy sgRNAs.

Takes sgRNAs designed by design_grnas.py (from the DASH paper).
Takes coverage depth of a region targeted by scRNAs.
Rarefies sgRNAs to a desired number by treating coverage depth as a probability density function to keep a sgRNA.
Outputs rarefied guides as a csv table and guides coordinates in a bed file.

## Dependencies

Python 3.x including packages:

* os
* numpy
* Bio

## Usage

With Cov_depth_profile variable, specify path to coverage depth profile (prepared by the Select_genomic_ragion.py script).
With Ref_seq_path variable, specify path to a sequence of ROI (prepared by the Select_genomic_ragion.py script).
With Guides_compend_path variable, specify path to guides csv file (prepared by the design_grnas.py script).
With Handle_seq variable, specify nucleotide sequence of guide handle (exactly as was provided in design_grnas.py script).
With Output_path variable, specify path to where output files will be generated.
With Total_num_guides variable, specify a desired number of guides after rarefying.
With Dataset_name variable, specify a dataset name.

## Output

Outputs rarefied guides as a csv table and guides coordinates in a bed file which can be veiwed in IGV alongside with coverage depth profile (wig) and sequence of ROI (fasta).
